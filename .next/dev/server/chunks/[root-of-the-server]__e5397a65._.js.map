{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/djtru/Documents/GitHub/SoCal-Coast-Interior-Pressure-Gradient-Tracker/app/api/locations/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\nimport { promises as fs } from \"fs\";\r\nimport path from \"path\";\r\nimport { Location } from \"@/types/location\";\r\nimport { z } from \"zod\";\r\n\r\nconst LocationSchema = z.object({\r\n  id: z.string().min(1),\r\n  name: z.string().min(1),\r\n  code: z.string().min(1),\r\n  latitude: z.number().min(-90).max(90),\r\n  longitude: z.number().min(-180).max(180),\r\n  type: z.enum([\"coast\", \"interior\"]),\r\n  elevation: z.number().optional(),\r\n});\r\n\r\nconst locationsFilePath = path.join(process.cwd(), \"data\", \"locations.json\");\r\n\r\nasync function readLocationsFile() {\r\n  const fileContents = await fs.readFile(locationsFilePath, \"utf8\");\r\n  return JSON.parse(fileContents);\r\n}\r\n\r\nasync function writeLocationsFile(data: any) {\r\n  await fs.writeFile(locationsFilePath, JSON.stringify(data, null, 2), \"utf8\");\r\n}\r\n\r\n// GET all locations\r\nexport async function GET() {\r\n  try {\r\n    const data = await readLocationsFile();\r\n    return NextResponse.json({\r\n      success: true,\r\n      locations: data.locations,\r\n      homeLocationId: data.homeLocationId,\r\n      dashboardLocationIds: data.dashboardLocationIds || [],\r\n      apiRefreshInterval: data.apiRefreshInterval || 300,\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Error reading locations:\", error);\r\n    return NextResponse.json(\r\n      { error: \"Failed to read locations\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n// POST - Add a new location\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json();\r\n    const validatedLocation = LocationSchema.parse(body);\r\n\r\n    const data = await readLocationsFile();\r\n\r\n    // Check if location already exists\r\n    if (data.locations.some((loc: Location) => loc.id === validatedLocation.id)) {\r\n      return NextResponse.json(\r\n        { error: \"Location with this ID already exists\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Check max locations (25)\r\n    if (data.locations.length >= 25) {\r\n      return NextResponse.json(\r\n        { error: \"Maximum of 25 locations allowed\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    data.locations.push(validatedLocation);\r\n    await writeLocationsFile(data);\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      location: validatedLocation,\r\n    });\r\n  } catch (error) {\r\n    if (error instanceof z.ZodError) {\r\n      return NextResponse.json(\r\n        { error: \"Invalid location data\", details: error.issues },\r\n        { status: 400 }\r\n      );\r\n    }\r\n    console.error(\"Error adding location:\", error);\r\n    return NextResponse.json(\r\n      { error: \"Failed to add location\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n// PUT - Update a location\r\nexport async function PUT(request: NextRequest) {\r\n  try {\r\n    const body = await request.json();\r\n    const validatedLocation = LocationSchema.parse(body);\r\n\r\n    const data = await readLocationsFile();\r\n    const index = data.locations.findIndex(\r\n      (loc: Location) => loc.id === validatedLocation.id\r\n    );\r\n\r\n    if (index === -1) {\r\n      return NextResponse.json(\r\n        { error: \"Location not found\" },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    data.locations[index] = validatedLocation;\r\n    await writeLocationsFile(data);\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      location: validatedLocation,\r\n    });\r\n  } catch (error) {\r\n    if (error instanceof z.ZodError) {\r\n      return NextResponse.json(\r\n        { error: \"Invalid location data\", details: error.issues },\r\n        { status: 400 }\r\n      );\r\n    }\r\n    console.error(\"Error updating location:\", error);\r\n    return NextResponse.json(\r\n      { error: \"Failed to update location\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n// PATCH - Update home location, dashboard locations, or API refresh interval\r\nexport async function PATCH(request: NextRequest) {\r\n  try {\r\n    const body = await request.json();\r\n    const { homeLocationId, dashboardLocationIds, apiRefreshInterval } = body;\r\n\r\n    const data = await readLocationsFile();\r\n\r\n    if (homeLocationId !== undefined) {\r\n      if (typeof homeLocationId !== \"string\") {\r\n        return NextResponse.json(\r\n          { error: \"homeLocationId must be a string\" },\r\n          { status: 400 }\r\n        );\r\n      }\r\n\r\n      const locationExists = data.locations.some(\r\n        (loc: Location) => loc.id === homeLocationId\r\n      );\r\n\r\n      if (!locationExists) {\r\n        return NextResponse.json(\r\n          { error: \"Location not found\" },\r\n          { status: 404 }\r\n        );\r\n      }\r\n\r\n      data.homeLocationId = homeLocationId;\r\n    }\r\n\r\n    if (dashboardLocationIds !== undefined) {\r\n      if (!Array.isArray(dashboardLocationIds)) {\r\n        return NextResponse.json(\r\n          { error: \"dashboardLocationIds must be an array\" },\r\n          { status: 400 }\r\n        );\r\n      }\r\n\r\n      if (dashboardLocationIds.length > 3) {\r\n        return NextResponse.json(\r\n          { error: \"Maximum 3 dashboard locations allowed\" },\r\n          { status: 400 }\r\n        );\r\n      }\r\n\r\n      const invalidIds = dashboardLocationIds.filter(\r\n        (id: string) => !data.locations.some((loc: Location) => loc.id === id)\r\n      );\r\n\r\n      if (invalidIds.length > 0) {\r\n        return NextResponse.json(\r\n          { error: `Invalid location IDs: ${invalidIds.join(\", \")}` },\r\n          { status: 400 }\r\n        );\r\n      }\r\n\r\n      data.dashboardLocationIds = dashboardLocationIds;\r\n    }\r\n\r\n    if (apiRefreshInterval !== undefined) {\r\n      if (typeof apiRefreshInterval !== \"number\") {\r\n        return NextResponse.json(\r\n          { error: \"apiRefreshInterval must be a number\" },\r\n          { status: 400 }\r\n        );\r\n      }\r\n\r\n      // Minimum 60 seconds to prevent API abuse\r\n      if (apiRefreshInterval < 60) {\r\n        return NextResponse.json(\r\n          { error: \"apiRefreshInterval must be at least 60 seconds\" },\r\n          { status: 400 }\r\n        );\r\n      }\r\n\r\n      // Maximum 1 hour (3600 seconds)\r\n      if (apiRefreshInterval > 3600) {\r\n        return NextResponse.json(\r\n          { error: \"apiRefreshInterval must be at most 3600 seconds\" },\r\n          { status: 400 }\r\n        );\r\n      }\r\n\r\n      data.apiRefreshInterval = apiRefreshInterval;\r\n    }\r\n\r\n    await writeLocationsFile(data);\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      homeLocationId: data.homeLocationId,\r\n      dashboardLocationIds: data.dashboardLocationIds,\r\n      apiRefreshInterval: data.apiRefreshInterval,\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Error updating settings:\", error);\r\n    return NextResponse.json(\r\n      { error: \"Failed to update settings\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n// DELETE - Remove a location\r\nexport async function DELETE(request: NextRequest) {\r\n  try {\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const locationId = searchParams.get(\"id\");\r\n\r\n    if (!locationId) {\r\n      return NextResponse.json(\r\n        { error: \"Location ID is required\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const data = await readLocationsFile();\r\n\r\n    // Prevent deleting home location\r\n    if (locationId === data.homeLocationId) {\r\n      return NextResponse.json(\r\n        { error: \"Cannot delete home location\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const initialLength = data.locations.length;\r\n    data.locations = data.locations.filter(\r\n      (loc: Location) => loc.id !== locationId\r\n    );\r\n\r\n    if (data.locations.length === initialLength) {\r\n      return NextResponse.json(\r\n        { error: \"Location not found\" },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // Remove from dashboard locations if present\r\n    if (data.dashboardLocationIds && Array.isArray(data.dashboardLocationIds)) {\r\n      data.dashboardLocationIds = data.dashboardLocationIds.filter(\r\n        (id: string) => id !== locationId\r\n      );\r\n    }\r\n\r\n    await writeLocationsFile(data);\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      message: \"Location deleted successfully\",\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Error deleting location:\", error);\r\n    return NextResponse.json(\r\n      { error: \"Failed to delete location\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}